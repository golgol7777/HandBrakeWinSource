diff -Nuar libdca/Makefile.am libdca_patched/Makefile.am
--- libdca/Makefile.am	2011-05-21 13:40:40 +0900
+++ libdca_patched/Makefile.am	2011-05-21 13:41:15 +0900
@@ -1,4 +1,6 @@
 SUBDIRS = libdca libao src test include
 DIST_SUBDIRS = $(SUBDIRS) autotools vc++
 
+ACLOCAL_AMFLAGS = -I m4
+
 EXTRA_DIST = bootstrap doc/libdca.txt
diff -Nuar libdca/configure.ac libdca_patched/configure.ac
--- libdca/configure.ac	2011-05-21 13:40:40 +0900
+++ libdca_patched/configure.ac	2011-05-21 13:44:14 +0900
@@ -3,6 +3,7 @@
 AC_INIT([libdca],[0.0.5])
 AC_CONFIG_SRCDIR([src/dcadec.c])
 AC_CONFIG_AUX_DIR(autotools)
+AC_CONFIG_MACRO_DIR([m4])
 AC_CONFIG_FILES([Makefile autotools/Makefile include/Makefile test/Makefile
     src/Makefile libdca/Makefile libao/Makefile vc++/Makefile
     libdca/libdca.pc libdca/libdts.pc])
@@ -29,9 +30,9 @@
 
     dnl -O3
     changequote(<<,>>)
-    TRY_CFLAGS=`echo "$OPT_CFLAGS $CFLAGS"|sed "s/-O[0-9]*//g"`
+    TRY_CFLAGS="$OPT_CFLAGS $CFLAGS"
     changequote([,])
-    TRY_CFLAGS="$TRY_CFLAGS -O3"
+    TRY_CFLAGS="-O3 $TRY_CFLAGS"
     AC_TRY_CFLAGS([$TRY_CFLAGS],[OPT_CFLAGS=$TRY_CFLAGS; CFLAGS=""])
 
     AC_ARG_ENABLE([debug],
@@ -48,11 +49,11 @@
     case "$host" in
     i?86-* | k?-*)
 	case "$host" in
-	i386-*) TRY_CFLAGS="$OPT_CFLAGS -mtune=i386";;
-	i486-*) TRY_CFLAGS="$OPT_CFLAGS -mtune=i486";;
-	i586-*) TRY_CFLAGS="$OPT_CFLAGS -mtune=pentium";;
-	i686-*) TRY_CFLAGS="$OPT_CFLAGS -mtune=pentiumpro";;
-	k6-*)   TRY_CFLAGS="$OPT_CFLAGS -mtune=k6";;
+	i386-*) TRY_CFLAGS="-march=i386 $OPT_CFLAGS";;
+	i486-*) TRY_CFLAGS="-march=i486 $OPT_CFLAGS";;
+	i586-*) TRY_CFLAGS="-march=pentium $OPT_CFLAGS";;
+	i686-*) TRY_CFLAGS="-march=pentiumpro $OPT_CFLAGS";;
+	k6-*)   TRY_CFLAGS="-march=k6 $OPT_CFLAGS";;
 	esac
 	AC_TRY_CFLAGS([$TRY_CFLAGS $CFLAGS],[OPT_CFLAGS=$TRY_CFLAGS]);;
     sparc-* | sparc64-*)
